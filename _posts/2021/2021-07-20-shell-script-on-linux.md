---
layout: post
title: "Linux Shell Script åˆå­¸"
date: 2021-07-20 11:02:51 +0800
category: linux
img: cover/bash.jpg
description: èº«ç‚ºä¸€å€‹è»Ÿé«”å·¥ç¨‹å¸«åœ¨ Linux ä¸Šæ“ä½œæŒ‡ä»¤æ˜¯å¿…é ˆè¦å­¸ç¿’çš„ï¼Œé›–ç„¶æœ¬äººä¹Ÿæ˜¯å·¥ä½œå¾Œæ‰æ¯”è¼ƒå¸¸ç”¨åˆ°ðŸ˜…ï¼Œä¸éŽå¸¸å¸¸æœƒæœ‰éœ€è¦æ‰“ä¸€å¤§ä¸²æŒ‡ä»¤æˆ–æ˜¯æ“ä½œä¸€äº›è¤‡é›œé‚è¼¯çš„æ™‚å€™ï¼Œé€™æ™‚å€™å°±å¯ä»¥æ’°å¯« shell script å¹«åŠ©è™•ç†è¤‡é›œçš„æŒ‡ä»¤ï¼Œå¯ä»¥åšåˆ°è‡ªå‹•åŒ–çš„è™•ç†ï¼Œæ˜¯å¯ä»¥å¹«åŠ©å·¥ç¨‹å¸«å·æ‡¶çš„åˆ©å™¨ï¼Œé€™ç¯‡ä¸»è¦åšäº›ç°¡å–®çš„ç­†è¨˜å¹«åŠ©è‡ªå·±ä¸è¦å¿˜è¨˜
lang: zh-TW
tags: [linux, shell script]
---

{{page.description}}

## å‰è¨€
é¦–å…ˆè¦çŸ¥é“ shell script å…¶å¯¦ä¸æ˜¯ä¸€ç¨®ç¨‹å¼èªžè¨€ï¼Œä»–çš„æ¦‚å¿µæ¯”è¼ƒåƒæ˜¯æŠŠæŒ‡ä»¤è…³æœ¬åŒ–ï¼ŒåŸ·è¡Œä¸Šé¡žä¼¼ç›´è­¯å¼çš„èªžè¨€ï¼Œå› æ­¤ shell script çš„ä½¿ç”¨ä¸Šéžå¸¸çš„å½ˆæ€§ï¼Œåªè¦æ˜¯ä½ å¯ä»¥åœ¨ bash ä¸Šç›´æŽ¥ä½¿ç”¨çš„æŒ‡ä»¤ï¼Œshell script ä¹Ÿéƒ½å¯ä»¥ä½¿ç”¨ï¼Œä¹Ÿå› æ­¤è¦å…ˆå° linux çš„åŸºæœ¬æŒ‡ä»¤æ“ä½œæœ‰äº›äº†è§£æ‰çŸ¥é“è©²æ’°å¯«ä»€éº¼

## Hello world
ç¬¬ä¸€å€‹ script ä¸å…ä¿—åœ°ä¾†å¯«å€‹ `Hello world.sh`

```bash
#!/bin/bash
echo -e "Hello world!!!\n"
```

ç¬¬ä¸€è¡Œçš„ `#!/bin/bash` è¡¨ç¤ºé€™å€‹è…³æœ¬çš„åŸ·è¡Œç’°å¢ƒï¼Œç„¶å¾Œæ’°å¯«å®Œä¹‹å¾Œä¸€å®šæœƒç™¼ç¾ä¸èƒ½åŸ·è¡Œï¼Œé‚£æ˜¯å› ç‚ºæ¬Šé™çš„å•é¡Œï¼Œé è¨­æ’°å¯«æ–‡æœ¬æ˜¯ä¸æœƒæœ‰åŸ·è¡Œæ¬Šé™çš„ï¼Œé€éŽ `ls -l` å¯ä»¥çœ‹åˆ°æª”æ¡ˆçš„æ¬Šé™ï¼Œç„¶å¾Œé€éŽä¸‹é¢æŒ‡ä»¤ä¾†çµ¦äºˆåŸ·è¡Œæ¬Šé™

```bash
chmod +x "Hello world.sh"
```

é€™æ¨£å°±èƒ½æˆåŠŸåŸ·è¡Œäº†
```bash
$ ./test.sh
Hello world!!!
```

## è®Šæ•¸
å¯«ç¨‹å¼ç•¶ç„¶è¦å…ˆçŸ¥é“æ€Žéº¼åšè®Šæ•¸å‘½åï¼Œä¸éŽè¦æ³¨æ„çš„æ˜¯ shell script çš„æ‰€æœ‰è®Šæ•¸éƒ½æ˜¯å­—ä¸²ï¼Œæ²’æœ‰ä»€éº¼è¤‡é›œçš„åž‹æ…‹å•é¡Œ
```bash
test_var=123
test_var="123"
test_var='123'
```

ä»¥ä¸Šä¸‰å€‹å¯«æ³•æ˜¯ä¸€æ¨£çš„ï¼Œè¦æ³¨æ„çš„æ˜¯ç­‰è™Ÿçš„å·¦å³ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œä½¿ç”¨è®Šæ•¸çš„æ–¹å¼å¦‚ä¸‹ï¼ŒåŠ ä¸åŠ èŠ±æ‹¬è™Ÿéƒ½å¯ä»¥

```bash
echo "${test_var}"
echo "$test_var"
```

## ç‰¹æ®Šè®Šæ•¸
shell script æœ‰ä¸€äº›é è¨­çš„ç‰¹åˆ¥è®Šæ•¸ï¼Œç”¨ä¾†å¹«åŠ©å‚³å…¥åƒæ•¸é€²è¡Œåˆ¤æ–·èˆ‡è™•ç†

| è®Šæ•¸  | æè¿°                                    |
| :---: | :-------------------------------------- |
| `$0`  | åŸ·è¡Œçš„ shell script æª”å                |
| `$n`  | n å¾ž 1 é–‹å§‹ï¼Œè¡¨ç¤ºè¼¸å…¥çš„ç¬¬å¹¾å€‹åƒæ•¸       |
| `$#`  | è¡¨ç¤ºç¸½å…±å‚³å…¥å¹¾å€‹åƒæ•¸                    |
| `$*`  | è¡¨ç¤ºå‚³å…¥çš„æ‰€æœ‰åƒæ•¸ï¼Œç”¨ç©ºæ ¼éš”é–‹          |
| `$@`  | è¡¨ç¤ºå‚³å…¥çš„æ‰€æœ‰åƒæ•¸ï¼Œæ¯å€‹åƒæ•¸ç”¨ `"` éš”é–‹ |
| `$?`  | å‰ä¸€å€‹æŒ‡ä»¤çš„å›žå‚³ç‹€æ…‹                    |
| `$$`  | ç•¶å‰ shell script çš„åŸ·è¡Œ PID            |

## é‹ç®—
å‰é¢èªªåˆ° shell script çš„è®Šæ•¸éƒ½æ˜¯å­—ä¸²ï¼Œé‚£è¦æ€Žéº¼åšæ•¸å­¸é‹ç®—å‘¢ï¼Œå¿…é ˆè¦é€éŽä¸€äº›ç‰¹åˆ¥çš„é—œéµå­—æ‰èƒ½åšåˆ°

åŸºæœ¬çš„åƒæ˜¯ `expr`ï¼Œè¦æ³¨æ„çš„æ˜¯é‹ç®—å­çš„å·¦å³å¿…é ˆè¦ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨çš„é‹ç®—å­è·Ÿå¤§éƒ¨åˆ†çš„ç¨‹å¼èªžè¨€éƒ½å¤§è‡´ç›¸åŒ

```bash
result = `expr 1 + 1`
echo ${result}
```

é‚„æœ‰ä¸€ç¨®æ¯”è¼ƒç›´è¦ºçš„åšæ³•æ˜¯ç”¨ `let`ï¼Œé€™å€‹å¯«æ³•è¦æ³¨æ„ä¸èƒ½æœ‰ç©ºç™½ï¼Œä¸éŽå¯«èµ·ä¾†è¼ƒç›´è¦º

```bash
let a=1+1
let b=a+2
let a++
let a+=2
```

é‚„æœ‰ä¸€ç¨®ç¥žå¥‡çš„è¡¨ç¤ºæ³• `$((...))` æˆ–æ˜¯ `$[...]`ï¼Œå¯ä»¥åœ¨å…©ç¨®è¡¨ç¤ºæ³•å…§å¯«å…¥é‹ç®—å¼å°±æœƒè½‰æˆè®Šæ•¸ï¼Œè€Œä¸”æœ‰æ²’æœ‰ç©ºç™½éƒ½æ²’é—œä¿‚

```bash
result=$((1+1))
result=$((result+1))
((result+=10)) # ä¹Ÿå¯ä»¥ç›´æŽ¥åœ¨å…§åšé‹ç®—ä¸åŠ ä¸Š $ è™Ÿçš„è©±å°±ä¸æœƒè½‰æˆè®Šæ•¸è¼¸å‡ºï¼Œä½†çµæžœä¸€æ¨£æœƒç•™åœ¨ resultï¼Œé ˆæ³¨æ„ç”¨ [] ä¸èƒ½ç”¨æ­¤ç”¨æ³•
((a=1+1,b=2+1,c=3+1)) # å¤šå€‹é‹ç®—å¼å¯ä»¥ç”¨ , åˆ†é–‹è¡¨ç¤º
```

é›–ç„¶ç”¨æ‹¬è™Ÿçš„æ–¹å¼çœ‹èµ·æ˜¯æœ€ç°¡å–®çš„ï¼Œä½†å¤ªå¤šçš„æ‹¬è™Ÿå€‹äººè¦ºå¾—æœ‰é»žä¸å¥½è®€ï¼Œæ‰€ä»¥è‡ªå·±æ¯”è¼ƒå–œæ­¡çš„é‚„æ˜¯å¯« `let`

## æµç¨‹æŽ§åˆ¶
é€™éƒ¨åˆ†å€‹äººè¦ºå¾—æœ€éº»ç…©çš„æ˜¯ï¼Œç©ºç™½çš„éƒ¨åˆ†éƒ½æ˜¯ä¸èƒ½å¤ çœç•¥çš„ï¼Œåªè¦æœ‰æ‰“éŒ¯çš„å°±æœƒé‹ä½œéŒ¯èª¤ï¼Œé€™é»žè¦ç‰¹åˆ¥æ³¨æ„

### if then else
åŸºæœ¬çš„ if çµæ§‹å¦‚ä¸‹ï¼Œæœ‰è¶£çš„æ˜¯ if çš„çµå°¾æ˜¯é¡›å€’éŽä¾†çš„ fiï¼Œé€™é»žè »æœ‰è¶£çš„ï¼Œç„¶å¾Œåˆ¤æ–·å¼æ˜¯ç”¨ `[]` ä¾†è¡¨ç¤ºï¼Œå¦‚æžœè¦å¤šæ¢ä»¶åˆ¤æ–·å°±éœ€è¦å¤šå€‹ `[]`

```bash
if [ $a == $b ]; then
    echo "a == b"
elif [ $a != $b ]
    echo "a != b"
else
    echo "ä¸å¯èƒ½ç™¼ç”Ÿ"
fi
```

ç„¶å¾Œæ˜¯é‚è¼¯é‹ç®—å­æœ‰é»žä¸ä¸€æ¨£ï¼Œä¸èƒ½ç›´æŽ¥ç”¨ `>` è·Ÿ `<` ä¾†è¡¨ç¤ºï¼Œè€Œæ˜¯å¦‚ä¸‹è¡¨

| ç¬¦è™Ÿ  | æ„ç¾©     |
| :---: | :------- |
| `-gt` | å¤§æ–¼     |
| `-lt` | å°æ–¼     |
| `-ge` | å¤§æ–¼ç­‰æ–¼ |
| `-le` | å°æ–¼ç­‰æ–¼ |

ç¤ºç¯„ä¸€å€‹å¤šæ¢ä»¶èˆ‡æ¯”è¼ƒé‹ç®—å­çš„ç”¨æ³•

```bash
if [ $a -gt 0 ] && [ $a -lt 100 ]; then
    echo " 0 < a < 100 "
fi
```

### case
é¡žä¼¼æ–¼ `switch case` çš„æ„Ÿè¦ºï¼Œç”¨åšå¤šåˆ†æ”¯åˆ¤æ–·
```bash
city='Kaohsiung'

case $language in
    Kaohsiung*) echo "é«˜é›„å¸‚"
    ;;
    Taipei*) echo "å°åŒ—å¸‚"
    ;;
    Tainan*) echo "å°å—å¸‚"
    ;;
    *) echo "æ‰¾ä¸åˆ°"
esac
```

## è¿´åœˆ
è¿´åœˆä¹Ÿæ˜¯åœ¨è‡ªå‹•åŒ–å·¥ä½œä¸­éžå¸¸é‡è¦çš„ä¸€ç’°ï¼Œæˆ–è€…èªªçµ•å¤§éƒ¨åˆ†æƒ³è¦å·æ‡¶çš„æ™‚å€™éƒ½æ˜¯è¦ç”¨åˆ°è¿´åœˆçš„æ™‚å€™XD

### for
shell script çš„ for æœ‰å¤šç¨®è¡¨ç¤ºæ–¹æ³•ï¼Œä¹Ÿæ˜¯æœ‰é»žæ··äº‚

```bash
for i in 1 2 3 4 5; do
    echo "number: $i"
done
```

ä¸Šé¢å¯«æ³•æ¯”è¼ƒåƒæ˜¯ foreach çš„æ„Ÿè¦ºï¼Œå…¶ä¸­çš„ `1 2 3 4 5` ä¹Ÿå¯ä»¥ç”¨ä¸€å€‹è®Šæ•¸å¸¶å…¥

```bash
list="1 2 3 4 5"
for i in $list; do
    echo "number: $i"
done
```

æˆ–æ˜¯æœ‰å€‹æ¯”è¼ƒç›´è¦ºçš„å¯«æ³•

```bash
for i in {1..5}; do
    echo "number: $i"
done
```

é€™å€‹å¯«æ³•ä¹Ÿå¯ä»¥å†è®Šæˆï¼Œæœ€å¾Œçš„ `..2` ä»£è¡¨ stepï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡åŠ  2ï¼Œæ‰€ä»¥æœƒè¼¸å‡º `1 3 5`

```bash
for i in {1..5..2}; do
    echo "number: $i"
done
```

é‚„æœ‰ä¸€ç¨®åŸºæœ¬ä¸Šè·Ÿç¨‹å¼èªžè¨€çš„å¯«æ³•æ²’ä»€éº¼ä¸åŒ

```bash
for ((i=1;i<=5;i++)); do
    echo "number: $i"
done
```

### while
while ä¹Ÿæ˜¯ä¸€èˆ¬ç¨‹å¼èªžè¨€å¸¸è¦‹çš„åŠŸèƒ½ï¼Œå¯«æ³•å¦‚ä¸‹

```bash
let i=1
while [ $i -le 5 ]; do
    echo "number: $i"
    let i+=1
done
```

### until
until æ¯”è¼ƒç‰¹åˆ¥ä¸€é»žï¼Œæ˜¯ä¸€èˆ¬ç¨‹å¼èªžè¨€æ²’æœ‰çš„åŠŸèƒ½ï¼Œä»–å…¶å¯¦å°±æ˜¯ while çš„å¦ä¸€ç¨®é¢å‘ï¼Œè¡¨ç¤ºç›´åˆ°æ¢ä»¶æˆç«‹å‰éƒ½åŸ·è¡Œ

```bash
let i=1
until [ $i -gt 5 ]; do
    echo "number: $i"
    let i+=1
done
```

## function
éš¨è‘—è¶Šä¾†è¶Šè¤‡é›œçš„è‡ªå‹•åŒ–åŠŸèƒ½ï¼Œæœ‰äº› script ä¹Ÿå¯ä»¥è¢«å¯«æˆå‡½æ•¸ä¸¦æŠ½è±¡åŒ–

```bash
function count(){
    for ((i=1;i<=5;i++)); do
        echo "number: $i"
    done
}

count # ä½¿ç”¨æ™‚ç•¶ä½œ command ä¾†ä½¿ç”¨å³å¯
```

å‘¼å« function æ™‚å°±åƒä½¿ç”¨ command ä¸€æ¨£ï¼Œè€Œå‚³éžåƒæ•¸çš„æ–¹å¼ä¹Ÿç›¸åŒç›´æŽ¥å¸¶åœ¨å¾Œé¢å³å¯

```bash
function count(){
    for ((i=1;i<=$1;i++)); do
        echo "number: $i"
    done
}

count 5
```

è€Œå‰é¢æœ‰æåˆ°ä¸€å€‹ç‰¹æ®Šè®Šæ•¸ `$?`ï¼Œå…¶å¯¦æœ€å¸¸ç”¨åˆ°çš„åœ°æ–¹å°±æ˜¯ function çš„å›žå‚³

```bash
function sum(){
    let sum=0
    for ((i=1;i<=$1;i++)); do
        let sum+=$i
    done
}

sum 5
echo "sum 1~5: $?"
```

---
## çµèªž
æœ¬ç¯‡æ˜¯ä¸€å€‹ shell script çš„ç°¡å–®ç­†è¨˜ï¼Œé–‹å§‹æŽ¥è§¸åˆ° Linux ä¸€å®šéƒ½æœƒæƒ³ä½¿ç”¨ shell script å› ç‚ºå¤ªå¤šæŒ‡ä»¤å¸¸å¸¸è¦ä¸‹ï¼Œå¯¦åœ¨å¾ˆéº»ç…©ï¼Œä½†ç”±æ–¼å¸¸å¸¸åœ¨å¯«çš„æ™‚å€™æœƒå¿˜è¨˜ä¸€äº›ç´°ç¯€ï¼Œå°Žè‡´å¸¸å¸¸è¦ä¸Šç¶²æŸ¥ï¼Œæ‰€ä»¥ä¹¾è„†è¨˜éŒ„ä¸€ä¸‹